<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dgg.store.mapper.RoleMapper">

    <select id="getPositionId" resultType="java.lang.String">
        SELECT position_id
        FROM user
        WHERE user_id = #{userId}
    </select>

    <select id="countPersonalPermission" resultType="java.lang.Integer">
        SELECT COUNT(0)
        FROM user_qm_permission_re uqpr
        INNER JOIN qm_permission_re qp
        ON qp.qm_permission_id = uqpr.qm_permission_id
        INNER JOIN permission p
        ON p.permission_id = qp.permission_id
        WHERE user_id = #{userId}
        AND CONCAT(p.permission_url,'.action') = #{url}
    </select>

    <select id="countWorkerPermission" resultType="java.lang.Integer">
        SELECT COUNT(0)
        FROM position_permission_re ppr
        INNER JOIN qm_permission_re qpr
        ON qpr.qm_permission_id = ppr.qm_permission_id
        INNER JOIN permission p
        ON p.permission_id = qpr.permission_id
        WHERE ppr.position_id = #{positionId}
        AND CONCAT(p.permission_url,'.action') = #{url}
    </select>

    <select id="getRoleId" resultType="java.lang.String">
        SELECT role_id
        FROM user
        WHERE user_id = #{userId}
    </select>
</mapper>